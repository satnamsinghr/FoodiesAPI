<!DOCTYPE html>
<html>
<head><meta charset="utf-8"><title>Order WS Test</title></head>
<body>
<h3>Order WS Test</h3>
Order ID: <input id="orderId" value="1" />
<button id="connectBtn">Connect & Subscribe</button>
<button id="disconnectBtn" disabled>Disconnect</button>
<pre id="log" style="background:#f5f5f5;padding:10px;height:200px;overflow:auto;"></pre>

<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
<script>
    let stompClient = null;

    function log(line) {
      const el = document.getElementById('log');
      el.textContent += line + '\n';
      el.scrollTop = el.scrollHeight;
    }

    document.getElementById('connectBtn').onclick = function () {
      const orderId = document.getElementById('orderId').value.trim();
      if (!orderId) return alert('Enter orderId');
      const socket = new SockJS('/ws');
      stompClient = Stomp.over(socket);
      stompClient.connect({}, function(frame) {
        log('Connected: ' + frame);
        stompClient.subscribe('/topic/orders/' + orderId, function(message) {
          log('Received: ' + message.body);
        });
        log('Subscribed to /topic/orders/' + orderId);
        document.getElementById('disconnectBtn').disabled = false;
        document.getElementById('connectBtn').disabled = true;
      }, function(err) { log('Connect error: ' + JSON.stringify(err)); });
    };

    document.getElementById('disconnectBtn').onclick = function () {
      if (stompClient) {
        stompClient.disconnect(() => { log('Disconnected'); document.getElementById('connectBtn').disabled = false; document.getElementById('disconnectBtn').disabled = true; });
      }
    };
  </script>
</body>
</html>
